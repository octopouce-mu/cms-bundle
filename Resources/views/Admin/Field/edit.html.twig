{% extends '@OctopouceCms/Admin/layout.html.twig' %}

{% block title %}Edit : {{ page.title }} - {{ parent() }}{% endblock %}

{% block main %}
    <div class="padding-filter">
        <div class="row title">
            <div class="col s12">
                <h1>Edit: {{ page.title }}</h1>
            </div>
        </div>
        {{ form_start(form) }}
        <div class="row">
            <div class="col s12">
                <div id="block-fields-list" data-prototype="{{ form_widget(form.fields.vars.prototype)|e }}"
                     data-widget-tags="{{ '<div class="box block"></div>'|e }}">
                    {% for blockField in form.fields %}
                        <div class="box block draggable">
                            <div class="content">
                                <button type="button" class="waves-effect waves-light btn-small remove-block red"><i class="fas fa-times"></i></button>
                                {{ form_errors(blockField) }}
                                {{ form_widget(blockField) }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <p>
                    <button type="button" class="add-another-collection-widget waves-effect waves-light btn"
                            data-list="#block-fields-list">Add Field</button>
                </p>
            </div>
        </div>
        {{ form_end(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {
            var dataPositionList = {};
            // $('.draggable').each(function (index) {
            //     dataPositionList[index] = { 'id' : $(this).data("id"), 'position': $(this).data("position") };
            // });
            var fixHelperModified = function (e, tr) {
                var $originals = tr.children();
                var $helper = tr.clone();
                $helper.children().each(function (index)
                {
                    $(this).width($originals.eq(index).width())
                });
                return $helper;
            };
            $('#block-fields-list').sortable({
                // helper: fixHelperModified,
                handle: ".content",
                placeholder: "ui-state-highlight",
                axis: 'y',
                container: '#block-fields-list',
                {#update: function( event, ui ) {#}
                    {#$.map($('tbody').find('.draggable'), function(el, index) {#}
                        {#dataPositionList[index]['id'] = $(el).attr('data-id');#}
                        {#dataPositionList[index]['position'] = index;#}
                    {#});#}
                    {#$.ajax({#}
                        {#data: {data: dataPositionList, class:'{{ entities.0|getClass}}'},#}
                        {#type: 'POST',#}
                        {#url: Routing.generate('octopouce_admin_admin_sortable_drag'),#}
                        {#success: function (data) {#}
                        {#},#}
                    {#});#}
                {#}#}
            });
        });
    </script>
{% endblock %}